deploy:
  needs: build
  runs-on: ubuntu-latest
  steps:
    # Step 1: Checkout the code again
    - name: Checkout code
      uses: actions/checkout@v3

    # Step 2: Install Heroku CLI (Required for deployment)
    - name: Install Heroku CLI
      run: |
        curl https://cli-assets.heroku.com/install.sh | sh
        heroku --version  # Check if Heroku CLI installed correctly

    # Step 3: Deploy to Heroku
    - name: Deploy to Heroku
      env:
        HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
      run: |
        echo "Setting Heroku remote..."
        heroku git:remote -a "${{ secrets.HEROKU_APP_NAME }}" || { echo "Failed to set remote"; exit 1; }

        # Set Git credentials
        git config --global user.email "kamaubrikam@gmail.com"
        git config --global user.name "MungaiBrianK"

        # Deploy to Heroku
        echo "Deploying to Heroku..."
        git push https://git.heroku.com/${{ secrets.HEROKU_APP_NAME }} main --force --set-upstream
